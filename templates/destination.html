<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ DESTINATION.place_name }} - Destination Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{url_for('static',filename='css/destination.css')}}">
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="/journey/{{ DESTINATION.Jid }}" class="btn-back"><i class="fa-solid fa-arrow-left"></i> Back to
                    Journey</a>
            </div>
            <div class="nav-center">
                <h1 class="nav-title">{{ DESTINATION.place_name }} Exploration</h1>
            </div>
            <div class="nav-right">
            </div>
        </div>
    </nav>

    <div class="expanded-wrapper">

        <div class="top-section">
            <div class="glass-card overview-card">
                <div class="overview-header">
                    <h2>{{ DESTINATION.place_name }}</h2>
                    <div class="badges-row">
                        <span class="badge status-{{ DESTINATION.visit_status }}">{{ DESTINATION.visit_status |
                            capitalize }}</span>
                        {% if DESTINATION.is_main %}
                        <span class="badge badge-main">Main Destination</span>
                        {% endif %}
                        <span class="badge badge-order">Visit Order #{{ DESTINATION.visit_order }}</span>
                    </div>
                </div>

                <div class="map-embed-container">
                    <iframe title="Google Maps Location" src="https://maps.google.com/maps?q={{ DESTINATION.place_name | urlencode }}&output=embed"
                        width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy">
                    </iframe>
                </div>
            </div>
        </div>

        <div class="main-grid">

            <div class="left-col">
                <div class="glass-card logs-card">
                    <h3 class="section-title">Travel Logs Section</h3>

                    <div class="logs-scroll-container">
                        {% if logs %}
                        {% for log in logs %}
                        <div class="log-entry" id="log-{{ log.Lid }}">
                            <div class="log-meta">
                                <i class="fa-regular fa-clock"></i> {{ log.created_at.strftime('%I:%M %p, %b %d') }}
                            </div>
                            <p class="log-text">{{ log.note_text }}</p>

                            {% if log.photos %}
                            <div class="log-photos">
                                {% for photo in log.photos[:3] %}
                                <img src="{{ url_for('static', filename=photo) }}" alt="Travel Memory"
                                    class="photo-thumbnail"
                                    onclick='openGalleryModal({{ log.photos | tojson }}, {{ loop.index0 }})'>
                                {% endfor %}

                                {% if log.photos|length > 3 %}
                                <div class="more-photos-badge" onclick='openGalleryModal({{ log.photos | tojson }}, 3)'>
                                    <span>+{{ log.photos|length - 3 }}</span>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            <button type="button" class="btn-delete-log" onclick="deleteLog({{ log.Lid }})"
                                title="Delete Memory"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="empty-state-box">
                            <i class="fa-regular fa-images"></i>
                            <p>Start documenting your experience here. Write a memory or attach a photo!</p>
                        </div>
                        {% endif %}
                    </div>

                    <div class="log-input-area">
                        <form id="logForm" enctype="multipart/form-data">
                            <textarea name="note" class="premium-textarea" placeholder="What did you experience here?"
                                required></textarea>
                            <div class="input-actions">
                                <div class="file-upload-wrapper">
                                    <input type="file" name="log_photos" id="log_photo" accept="image/*"
                                        class="hidden-file" multiple>
                                    <label for="log_photo" class="btn-attach">
                                        <i class="fa-solid fa-camera"></i> <span id="fileName">Attach Photo(s)</span>
                                    </label>
                                </div>
                                <button type="submit" class="btn-primary">Save Memory</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="right-col">
                <div class="glass-card reminders-card sticky-element">
                    <h3 class="section-title">Reminders & Tasks Card</h3>

                    <div class="reminders-scroll">
                        {% if reminders %}
                        {% for reminder in reminders %}
                        <div class="reminder-item" id="reminder-{{ reminder.Rid }}">
                            <label class="checkbox-wrapper">
                                <input type="checkbox" {% if reminder.status==1 %}checked{% endif %}
                                    onclick="toggleReminder({{ reminder.Rid }}, this.checked)">
                                <span class="checkmark"></span>
                                <span class="rem-text {% if reminder.status == 1 %}completed{% endif %}">{{
                                    reminder.rem_text }}</span>
                            </label>
                            <button type="button" class="btn-delete-rem" title="Delete Reminder" onclick="deleteReminder({{ reminder.Rid }})"><i
                                    class="fa-solid fa-xmark"></i></button>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="empty-state-box text-center">
                            <img src="{{ url_for('static', filename='UPLOADS/map_icon.png') }}" alt="No tasks"
                                style="width: 50px; opacity: 0.5; margin-bottom: 10px;"
                                onerror="this.style.display='none'">
                            <p>No tasks added yet.</p>
                        </div>
                        {% endif %}
                    </div>

                    <form id="reminderForm" class="reminder-input-area">
                        <input type="text" name="rem_text" class="premium-input"
                            placeholder="Add a task for this destination..." required>
                        <input type="hidden" name="status" value="0">
                        <button type="submit" class="btn-primary mt-2 w-100">Add Task</button>
                    </form>
                </div>
            </div>

        </div>
    </div>

    <div id="photoModal" class="modal">
        <span class="close-modal" onclick="closePhotoModal()"><i class="fa-solid fa-xmark"></i></span>

        <div class="gallery-container">
            <button class="gallery-btn prev-btn" id="prevBtn" title="Previous Photo" onclick="prevImage(event)"><i
                    class="fa-solid fa-chevron-left"></i></button>

            <img class="modal-content" id="expandedPhoto" alt="Expanded Photo">

            <button class="gallery-btn next-btn" id="nextBtn" title="Next Photo" onclick="nextImage(event)"><i
                    class="fa-solid fa-chevron-right"></i></button>
        </div>

        <div id="galleryCounter" class="gallery-counter">1 / 1</div>
    </div>

    <div id="destination-data" data-did="{{ DESTINATION.Did }}" style="display: none;"></div>
    <script src="{{url_for('static',filename='js/destination.js')}}"></script>
</body>

</html>