<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ JOURNEY.J_name }} - Journey Details</title>
    <link rel="stylesheet" href="{{url_for('static',filename='css/journey.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="{{ url_for('dashboard') }}" class="btn-back">‚Üê Back to Dashboard</a>
            </div>
            <div class="nav-center">
                <h1 class="nav-title">{{ JOURNEY.J_name }}</h1>
            </div>
            <!-- <div class="nav-right">
                <button class="btn-outline" onclick="openEditJourneyModal()">‚úèÔ∏è Edit Journey</button> -->

            <div class="nav-right">
                <button class="btn-outline" onclick="openEditJourneyModal()">‚úèÔ∏è Edit Journey</button>

                <div class="profile-menu">
                    {% if current_user.profile_photo_path %}
                    <img src="{{ url_for('static', filename=current_user.profile_photo_path.split('static/')[1]) }}"
                        alt="Profile" class="profile-pic" onclick="toggleProfileMenu()"
                        onerror="this.src='{{ url_for('static', filename='images/default-avatar.png') }}'">
                    {% else %}
                    <div class="profile-pic profile-placeholder" onclick="toggleProfileMenu()">
                        {{ current_user.Name[0] | upper }}
                    </div>
                    {% endif %}

                    <div class="dropdown-content" id="profileDropdown">
                        <a href="{{ url_for('dashboard') }}"><i class="fa-solid fa-house"></i> Dashboard</a>
                        <a href="{{ url_for('profile') }}"><i class="fa-solid fa-user"></i> Profile</a>
                        <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 5px 0;">
                        <a href="{{ url_for('logout') }}"><i class="fa-solid fa-arrow-right-from-bracket"></i>
                            Logout</a>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </nav>

    <div class="layout-container">

        <div class="content-left">

            <div class="journey-header-card">
                <div class="header-main">
                    <h2>{{ JOURNEY.J_name }}</h2>
                    <span class="status-badge status-inprogress">In Progress</span>
                </div>
                <div class="journey-dates">
                    üìÖ {{ JOURNEY.Start_date.strftime('%B %d, %Y') }} ‚Äî {{ JOURNEY.end_date.strftime('%B %d, %Y') }}
                </div>
                {% if JOURNEY.description %}
                <p class="journey-description">{{ JOURNEY.description }}</p>
                {% endif %}
            </div>

            <div class="section-card">
                <div class="section-header-flex">
                    <h3>üìç Destination Timeline</h3>
                    {% if DESTINATION|length > 0 %}
                    <button class="btn-text" onclick="openDestinationModal()">+ Add Destination</button>
                    {% endif %}
                </div>

                {% if DESTINATION|length > 0 %}
                <div class="timeline-container">
                    {% for destination in DESTINATION | sort(attribute='visit_order') %}
                    <div class="timeline-item">
                        <div class="timeline-marker">{{ destination.visit_order }}</div>
                        <div class="destination-card">
                            <div class="dest-info">
                                <h4>{{ destination.place_name }} {% if destination.is_main %}‚≠ê{% endif %}</h4>
                                <div class="dest-meta">
                                    <span class="status-pill status-{{ destination.visit_status }}"
                                        id="status-{{ destination.Did }}">{{ destination.visit_status | capitalize
                                        }}</span>
                                    {% if destination.map %}
                                    <a href="{{ destination.map }}" target="_blank" class="map-link">üó∫Ô∏è View Map</a>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="dest-actions">
                                <button type="button" class="btn-icon" title="Toggle Status"
                                    onclick="toggleStatus({{ destination.Did }}, this)">Change status</button>
                                <button type="button" class="btn-icon" title="View Details"
                                    onclick="viewDestination({{ destination.Did }})">View Destination</button>
                                <button type="button" class="btn-icon" title="Edit" onclick="openEditModal(this)"
                                    data-id="{{ destination.Did }}" data-name="{{ destination.place_name }}"
                                    data-order="{{ destination.visit_order }}"
                                    data-status="{{ destination.visit_status }}"
                                    data-is_main="{{ destination.is_main|int }}"
                                    data-map="{{ destination.map or '' }}">Edit</button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state-box">
                    <div class="empty-icon">üó∫Ô∏è</div>
                    <h4>Your map is blank!</h4>
                    <p>Every great journey starts with a single destination. Where are you heading first?</p>
                    <button class="btn-primary" onclick="openDestinationModal()">+ Add Your First Destination</button>
                </div>
                {% endif %}
            </div>

            <div class="section-card">
                <div class="section-header-flex">
                    <h3>üí∞ Financial Overview</h3>
                    {% if BUDGET %}
                    <button class="btn-text"
                        onclick="document.getElementById('expenseFormContainer').classList.toggle('hidden')">+ Add
                        Expense</button>
                    {% endif %}
                    <div class="expense-form-container">
                        <button type="button" class="btn-text" style="width: 100%; "
                            onclick="openEditBudgetModal({{ BUDGET.t_b_amount }})"> +Edit Total Budget</button>

                    </div>
                </div>


                {% if BUDGET %}
                <div class="financial-stats">
                    <div class="stat-box">
                        <span class="stat-label">Total Budget</span>
                        <span class="stat-value">RS {{ "%.2f"|format(BUDGET.t_b_amount) }}</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Total Spent</span>
                        <span class="stat-value">RS {{ "%.2f"|format(TOTAL_SPENT) }}</span>
                    </div>
                    <div class="stat-box {% if REMAINING >= 0 %}balance-positive{% else %}balance-negative{% endif %}">
                        <span class="stat-label">Remaining Balance</span>
                        <span class="stat-value">RS {{ "%.2f"|format(REMAINING) }}</span>
                    </div>
                </div>
                <!-- <div class="expense-form-container">
                    <button type="button" class="btn btn-secondary" style="width: 100%; margin-top: 15px;"
                        onclick="openEditBudgetModal({{ BUDGET.t_b_amount }})"> Edit Total Budget</button>
                </div> -->

                <div id="expenseFormContainer" class="hidden form-dropdown">
                    <form id="expenseForm" class="inline-form">
                        <input type="text" id="expense_description" name="description"
                            placeholder="What was this for? (e.g., Dinner)">
                        <input type="number" id="expense_amount" name="amount" step="0.01" min="0.01" required
                            placeholder="Amount ($)">
                        <input type="date" id="expense_date" name="expense_date" title="Expense Date" required>
                        <button type="submit" class="btn-primary">Save Expense</button>
                    </form>
                </div>
                <h4 style="color: #667eea; margin-bottom: 15px;">Spending History</h4>
                {% if EXPENSES|length > 0 %}
                <div class="expense-list">
                    {% for expense in EXPENSES %}
                    <div class="expense-item" id="expense-{{ expense.Eid }}">
                        <div class="exp-left">
                            <div class="exp-icon">üí≥</div>
                            <div>
                                <div class="exp-desc">{{ expense.description or 'Uncategorized Expense' }}</div>
                                <div class="exp-date">{{ expense.expense_date.strftime('%B %d, %Y') }}</div>
                            </div>
                        </div>
                        <div class="exp-right">
                            <div class="exp-amount">-${{ "%.2f"|format(expense.amount) }}</div>
                            <button type="button" class="btn-icon-danger" onclick="deleteExpense({{ expense.Eid }})"
                                title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-subtext">No expenses tracked yet.</div>
                {% endif %}

                {% else %}
                <div class="empty-state-box">
                    <div class="empty-icon">üíµ</div>
                    <h4>No budget allocated</h4>
                    <p>Keep your finances on track by setting an initial budget for this journey.</p>
                    <button type="button" class="btn-primary" onclick="openBudgetModal()">Set Journey Budget</button>
                </div>
                {% endif %}
            </div>

        </div>
        <div class="content-right">
            <div class="sticky-sidebar">
                <div class="reminders-card">
                    <div class="reminders-header">
                        <h3>Journey Reminders</h3>
                        <span class="badge">{{ REMINDERS|length }}</span>
                    </div>

                    <div class="reminders-list" id="remindersContainer">
                        {% if REMINDERS|length > 0 %}
                        {% for reminder in REMINDERS %}
                        <div class="reminder-item" data-reminder-id="{{ reminder.Rid }}"
                            data-destination-id="{{ reminder.Did }}">
                            <div class="rem-header">
                                <span class="rem-tag">{{ reminder.destination_name }}</span>
                                <div class="rem-dot"></div>
                            </div>
                            <div class="rem-text">{{ reminder.rem_text }}</div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="reminders-empty">
                            <p>All caught up! No pending reminders for this journey.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer subtle-footer">
        <div class="footer-container">
            <div class="footer-brand subtle-brand">
                <h2>TrekFolio</h2>
                <p>Plan smarter journeys. Travel with clarity.</p>
            </div>
            <div class="footer-social subtle-social">
                <div class="social-icons">
                    <a href="mailto:sankarkrishnap124@gmail.com" title="Email Me"><i
                            class="fa-solid fa-envelope"></i></a>
                    <a href="https://www.linkedin.com/in/sankar-krishna-p/" target="_blank" rel="noopener noreferrer"
                        title="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
                    <a href="https://github.com/SANKAR-124" target="_blank" rel="noopener noreferrer" title="GitHub"><i
                            class="fa-brands fa-github"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom subtle-bottom">
            <p>&copy; 2026 TrekFolio . All rights reserved.</p>
            <p>Built by SANKAR & Irfaahh</p>
        </div>
    </footer>
    <div id="destinationModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Add Destination</h2>
            <form id="destinationForm">
                <div class="form-group"><label>Place Name *</label><input type="text" id="place_name" name="place_name"
                        title="Place Name" required></div>
                <div class="form-group"><label>Visit Order *</label><input type="number" id="visit_order"
                        name="visit_order" title="Visit Order" min="1" required></div>
                <div class="form-group">
                    <label>Status *</label>
                    <select id="visit_status" name="visit_status" title="Visit Status" required>
                        <option value="planned">Planned</option>
                        <option value="visiting">Visiting</option>
                        <option value="visited">Visited</option>
                    </select>
                </div>
                <div class="form-group"><label>Main Destination</label><select id="is_main" name="is_main"
                        title="Main Destination">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select></div>
                <div class="form-group"><label>Map URL</label><input type="url" id="map" name="map" title="Map URL">
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn-secondary" onclick="closeDestinationModal()">Cancel</button>
                    <button type="button" id="deleteDestBtn" style="display: none;" class="btn-danger"
                        onclick="deleteDestination()">Delete</button>
                    <button type="submit" class="btn-primary" id="submitBtn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editJourneyModal" class="modal">
        <div class="modal-content">
            <h2>Edit Journey</h2>
            <form id="editJourneyForm">
                <div class="form-group"><label>Journey Name *</label><input type="text" id="edit_j_name" name="J_name"
                        title="Journey Name" required></div>
                <div class="form-group"><label>Start Date *</label><input type="date" id="edit_start_date"
                        name="start_date" title="Start Date" required></div>
                <div class="form-group"><label>End Date *</label><input type="date" id="edit_end_date" name="end_date"
                        title="End Date" required></div>
                <div class="form-group"><label>Description</label><textarea id="edit_description" name="description"
                        title="Description"></textarea></div>
                <div class="form-buttons">
                    <button type="button" class="btn-secondary" onclick="closeEditJourneyModal()">Cancel</button>
                    <button type="button" id="deleteJourneyBtn" class="btn-danger" onclick="deleteJourney()">Delete
                        Journey</button>
                    <button type="submit" class="btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>

    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <h2>Set Budget</h2>
            <form id="budgetForm">
                <div class="form-group"><label>Budget Amount *</label><input type="number" id="budget_amount"
                        name="amount" step="0.01" min="0.01" title="Budget Amount" required></div>
                <div class="form-buttons">
                    <button type="button" class="btn-secondary" onclick="closeBudgetModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Set Budget</button>
                </div>
            </form>
        </div>
    </div>
    <div id="editBudgetModal" class="modal">
        <div class="modal-content">
            <h2>Edit Budget</h2>
            <div class="form-line"></div>

            <form id="editBudgetForm">
                <div class="form-group">
                    <label for="edit_budget_amount">Update Budget Amount *</label>
                    <input type="number" id="edit_budget_amount" name="amount" step="0.01" min="0.01" required>
                </div>

                <div class="form-buttons">
                    <button type="submit" class="form-btn form-btn-submit btn-secondary">Update Budget</button>
                    <button type="button" class="form-btn form-btn-cancel btn-secondary"
                        onclick="closeEditBudgetModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="journey-data" data-jid="{{ JOURNEY.Jid }}" data-name="{{ JOURNEY.J_name }}"
        data-start="{{ JOURNEY.Start_date.strftime('%Y-%m-%d') }}"
        data-end="{{ JOURNEY.end_date.strftime('%Y-%m-%d') }}" data-desc="{{ JOURNEY.description or '' }}"
        style="display: none;"></div>
    <script src="{{url_for('static',filename='js/journey.js')}}"></script>
</body>

</html>